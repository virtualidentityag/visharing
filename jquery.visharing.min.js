/*
 * jquery.visharing.js | Improved social sharing
 * Virtual Identity AG - Jonathan Weiß
 *
 * Based on:
 * jquery.socialshareprivacy.js | 2 Klicks fuer mehr Datenschutz
 *
 * http://www.heise.de/extras/socialshareprivacy/
 * http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html
 *
 * Copyright (c) 2011 Hilko Holweg, Sebastian Hilbig, Nicolas Heiringhoff, Juergen Schmidt,
 * Heise Zeitschriften Verlag GmbH & Co. KG, http://www.heise.de
 *
 * is released under the MIT License http://www.opensource.org/licenses/mit-license.php
 *
 * Spread the word, link to us if you can.
 */
(function(a){a.fn.viSharing=function(b){function l(b){var c=a(b.target).is("label")?a(b.target).parent().find("#"+a(b.target).attr("for")):a(b.target);if(c.attr("checked")!="checked"){var d="";if(c.attr("name")=="perma_status_facebook"){d="facebook"}else if(c.attr("name")=="perma_status_twitter"){d="twitter"}else{d="gplus"}var e=Math.round((c.closest("li").position().left+c.closest("li").find("div").outerWidth())/2);var f=a("#socialshareprivacy .cb_layer").length?a("#socialshareprivacy .cb_layer"):a('<div class="cb_layer info" />').appendTo("#socialshareprivacy .social_share_privacy_area");var g=c.closest("li").position();var e=g.left-f.outerWidth()+c.closest("li").find("div").outerWidth();function h(){if(a(this).index()==1){j(d);c.attr("checked",true);a("#socialshareprivacy input[name="+c.attr("name")+"]").click();c.attr("checked",true)}f.hide().find("input").unbind("click",h)}f.html(a("#socialshareprivacy li."+d+" .info").html()).show().data("type",d).css({left:e+"px",top:g.top+"px"}).find("input").click(h)}}function k(b){if(a(this).index()==1){a(b.target).closest(".help_info").find(".switch").click();var c=a(b.target).closest(".help_info").find(".dummy_btn").attr("class").split(" ")[0];j(c)}else{a(b.target).closest(".help_info").removeClass("display")}}function j(a){}function i(){var b=h("DC.title");var c=h("DC.creator");if(b.length>0){if(c.length>0){b=b+" - "+c}}else{b=a("title").text()}return encodeURIComponent(b)}function h(a){var b=jQuery('meta[name="'+a+'"]').attr("content");return b?b:""}function g(a,b){var c=decodeURIComponent(a);if(c.length<=b){return a}var d=c.substring(0,b-1).lastIndexOf(" ");c=encodeURIComponent(c.substring(0,d))+"…";return c}var c={services:{facebook:{status:"on",app_id:"__FB_APP-ID__",dummy_img:"socialshareprivacy/images/dummy_facebook.png",txt_info:'<p><em style="color:green;">Dies ist ein Mustertext ohne GewÃ¤hr. Bitte stimmen Sie den von Ihnen verwendeten Text mit Ihrem Datenschutzbeauftragten ab.</em><br/>Bereits durch das Anzeigen des Like-Buttons werden personenbeziehbare und eventuell auch personenbezogenen Daten von mir an Facebook in die USA Ã¼bertragen. Des Weiteren werden Cookies eingesetzt, deren FunktionalitÃ¤t von Facebook nicht vollstÃ¤ndig und abschlieÃŸend geklÃ¤rt ist.<br />Beachten Sie bitte auch die Informationen in der <a href="facebook.html" target="_blank">DatenschutzerklÃ¤rung</a>.<br />Ich stimme diesen DatenÃ¼bertragungen (bis auf Widerruf) zu.</p><input class="btn" rel="fb-ok" type="button" value="OK, einverstanden" /> <input class="btn" rel="fb-cancel" type="button" value="Abbrechen" />',txt_fb_off:"nicht mit Facebook verbunden",txt_fb_on:"mit Facebook verbunden",perma_option:"on",display_name:"Facebook",referrer_track:"",language:"de_DE",action:"like"},twitter:{status:"on",dummy_img:"socialshareprivacy/images/dummy_twitter.png",txt_info:'<p><em style="color:green;">Dies ist ein Mustertext ohne GewÃ¤hr. Bitte stimmen Sie den von Ihnen verwendeten Text mit Ihrem Datenschutzbeauftragten ab.</em><br/>Bereits durch das Anzeigen des Tweet-Buttons werden personenbeziehbare und eventuell auch personenbezogenen Daten von mir an Twitter in die USA Ã¼bertragen. Des Weiteren werden Cookies eingesetzt, deren FunktionalitÃ¤t von Twitter nicht vollstÃ¤ndig und abschlieÃŸend geklÃ¤rt ist.<br />Beachten Sie bitte auch die Informationen in der <a href="twitter.html" target="_blank">DatenschutzerklÃ¤rung</a>.<br />Ich stimme diesen DatenÃ¼bertragungen (bis auf Widerruf) zu.</p><input class="btn" rel="tw-ok" type="button" value="OK, einverstanden" /> <input class="btn" rel="tw-cancel" type="button" value="Abbrechen" />',txt_twitter_off:"nicht mit Twitter verbunden",txt_twitter_on:"mit Twitter verbunden",perma_option:"on",display_name:"Twitter",referrer_track:"",tweet_text:i},gplus:{status:"on",dummy_img:"socialshareprivacy/images/dummy_gplus.png",txt_info:'<p><em style="color:green;">Dies ist ein Mustertext ohne GewÃ¤hr. Bitte stimmen Sie den von Ihnen verwendeten Text mit Ihrem Datenschutzbeauftragten ab.</em><br/>Bereits durch das Anzeigen des +1-Buttons werden personenbeziehbare und eventuell auch personenbezogenen Daten von mir an Google in die USA Ã¼bertragen. Des Weiteren werden Cookies eingesetzt, deren FunktionalitÃ¤t von Google nicht vollstÃ¤ndig und abschlieÃŸend geklÃ¤rt ist.<br />Beachten Sie bitte auch die Informationen in der <a href="google.html" target="_blank">DatenschutzerklÃ¤rung</a>.<br />Ich stimme diesen DatenÃ¼bertragungen (bis auf Widerruf) zu.</p><input class="btn" rel="g-ok" type="button" value="OK, einverstanden" /> <input class="btn" rel="g-cancel" type="button" value="Abbrechen" />',txt_gplus_off:"nicht mit Google+ verbunden",txt_plus_on:"mit Google+ verbunden",perma_option:"on",display_name:"Google+",referrer_track:"",language:"de"}},info_link:"http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html",txt_help:'<em style="color:green;">Dies ist ein Mustertext ohne GewÃ¤hr. Bitte stimmen Sie den von Ihnen verwendeten Text mit Ihrem Datenschutzbeauftragten ab.</em><br />Wenn Sie die HÃ¤kchen setzen, werden kÃ¼nftig personenbeziehbare oder personenbezogene Daten von Ihnen auch bei kÃ¼nftigen Besuch dieses Webauftritts an Facebook, Twitter oder Google gesendet, ohne dass Sie in der Zukunft noch einmal explizit einwilligen mÃ¼ssen. Zu diesem Zweck wird beim Aktivieren einer Checkbox ein Cookie gesetzt. Durch Deaktivieren der Checkbox wird dieses Cookie wieder entfernt.<br />Von Facebook, Twitter und Google werden jeweils auch Cookies eingesetzt. Beachten Sie bitte auch die Informationen in unseren DatenschutzerklÃ¤rungen zu <a href="facebook.html" target="_blank">Facebook</a>, <a href="twitter.html" target="_blank">Twitter</a> und <a href="google.html" target="_blank">Google</a>.<br />Ich stimme diesen DatenÃ¼bertragungen auch fÃ¼r die Zukunft (bis auf Widerruf) zu.',settings_perma:"Dauerhaft aktivieren und Datenüber­tragung zustimmen:",cookie_path:"/",cookie_domain:document.location.host,cookie_expires:"365",css_path:"socialshareprivacy/socialshareprivacy.css"};var b=a.extend(true,c,b);if(b.services.facebook.status=="on"&&b.services.facebook.app_id!="__FB_APP-ID__"||b.services.twitter.status=="on"||b.services.gplusone.status=="on"){link=a('<link rel="stylesheet" type="text/css"/>');a("head").append(link);link.attr("href",b.css_path);a(this).prepend('<ul class="social_share_privacy_area"></ul>');var d=a(".social_share_privacy_area",this);var e=document.location.href;var f=a('link[rel="canonical"]').attr("href");if(f&&f.length>0){if(f.indexOf("http")<0){f=document.location.protocol+"//"+document.location.host+f}e=f}}return this.each(function(){if(b.services.facebook.status=="on"){if(b.services.facebook.app_id!="__FB_APP-ID__"){var c=encodeURIComponent(e+b.services.facebook.referrer_track);var f='<iframe src="http://www.facebook.com/plugins/like.php?locale='+b.services.facebook.language+"&app_id="+b.services.facebook.app_id+"&href="+c+"&send=false&layout=button_count&width=120&show_faces=false&action="+b.services.facebook.action+'&colorscheme=light&font&height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden;" allowTransparency="true"></iframe>';var h='<img src="'+b.services.facebook.dummy_img+'" alt="Facebook "Like"-Dummy" class="fb_like_privacy_dummy" />';d.append('<li class="facebook help_info"><span class="info">'+b.services.facebook.txt_info+'</span><span class="switch off">'+b.services.facebook.txt_fb_off+'</span><div class="fb_like dummy_btn">'+h+"</div></li>");var i=a("li.facebook",d);a("li.facebook div.fb_like img.fb_like_privacy_dummy,li.facebook span.switch",d).live("click",function(){if(i.find("span.switch").hasClass("off")){i.addClass("info_off");i.find("span.switch").addClass("on").removeClass("off").html(b.services.facebook.txt_fb_on);i.find("img.fb_like_privacy_dummy").replaceWith(f)}else{i.removeClass("info_off");i.find("span.switch").addClass("off").removeClass("on").html(b.services.facebook.txt_fb_off);i.find(".fb_like").html(h)}})}else{try{console.log("Fehler: Es ist keine Facebook App-ID hinterlegt.")}catch(j){}}}if(b.services.twitter.status=="on"){var m=b.services.twitter.tweet_text;if(typeof m=="function"){m=m()}m=g(m,"120");var n=encodeURIComponent(e+b.services.twitter.referrer_track);var o=encodeURIComponent(e);var p='<iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url='+n+"&counturl="+o+"&text="+m+'&count=horizontal"></iframe>';var q='<img src="'+b.services.twitter.dummy_img+'" alt=""Tweet this"-Dummy" class="tweet_this_dummy" />';d.append('<li class="twitter help_info"><span class="info">'+b.services.twitter.txt_info+'</span><span class="switch off">'+b.services.twitter.txt_twitter_off+'</span><div class="tweet dummy_btn">'+q+"</div></li>");var r=a("li.twitter",d);a("li.twitter div.tweet img,li.twitter span.switch",d).live("click",function(){if(r.find("span.switch").hasClass("off")){r.addClass("info_off");r.find("span.switch").addClass("on").removeClass("off").html(b.services.twitter.txt_twitter_on);r.find("img.tweet_this_dummy").replaceWith(p)}else{r.removeClass("info_off");r.find("span.switch").addClass("off").removeClass("on").html(b.services.twitter.txt_twitter_off);r.find(".tweet").html(q)}})}if(b.services.gplus.status=="on"){var s=e+b.services.gplus.referrer_track;var t='<div class="g-plusone" data-size="medium" data-href="'+s+'"></div><script type="text/javascript">window.___gcfg = {lang: "'+b.services.gplus.language+'"}; (function(){ var po = document.createElement("script"); po.type = "text/javascript"; po.async = true; po.src = "https://apis.google.com/js/plusone.js"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s); })(); </script>';var u='<img src="'+b.services.gplus.dummy_img+'" alt=""Google+1"-Dummy" class="gplus_one_dummy" />';d.append('<li class="gplus help_info"><span class="info">'+b.services.gplus.txt_info+'</span><span class="switch off">'+b.services.gplus.txt_gplus_off+'</span><div class="gplusone dummy_btn">'+u+"</div></li>");var v=a("li.gplus",d);a("li.gplus div.gplusone img,li.gplus span.switch",d).live("click",function(){if(v.find("span.switch").hasClass("off")){v.addClass("info_off");v.find("span.switch").addClass("on").removeClass("off").html(b.services.gplus.txt_gplus_on);v.find("img.gplus_one_dummy").replaceWith(t)}else{v.removeClass("info_off");v.find("span.switch").addClass("off").removeClass("on").html(b.services.gplus.txt_gplus_off);v.find(".gplusone").html(u)}})}d.append('<li class="settings_info"><div class="settings_info_menu off perma_option_off"><a href="'+b.info_link+'"></a><span class="help_info icon"><span class="info">'+b.txt_help+"</span></span></div></li>");a(".help_info input").live("click",k);a(".help_info:not(.info_off)",d).live("mouseenter",function(){var b=a(this);a("#socialshareprivacy .facebook.help_info.display").removeClass("display");a(this).addClass("display");a("#socialshareprivacy .cb_layer").hide()});a(".help_info",d).live("mouseleave",function(){var b=a(this).data("timeout_id");window.clearTimeout(b);if(a(this).hasClass("display")){a(this).removeClass("display")}});if((b.services.facebook.status=="on"&&b.services.facebook.perma_option=="on"&&b.services.facebook.app_id!="__FB_APP-ID__"||b.services.twitter.status=="on"&&b.services.twitter.perma_option=="on"||b.services.gplus.status=="on"&&b.services.gplus.perma_option=="on")&&(a.browser.msie&&a.browser.version>7||!a.browser.msie)){var w=document.cookie.split(";");var x="{";for(var y=0;y<w.length;y++){var z=w[y].split("=");x+='"'+a.trim(z[0])+'":"'+a.trim(z[1])+'"';if(y<w.length-1){x+=","}}x+="}";x=JSON.parse(x);function A(a,b,c,d,e){var f=new Date;f.setTime(f.getTime()+c*24*60*60*1e3);document.cookie=a+"="+b+"; expires="+f.toUTCString()+"; path="+d+"; domain="+e}function B(a,c){var d=new Date;d.setTime(d.getTime()-100);document.cookie=a+"="+c+"; expires="+d.toUTCString()+"; path="+b.cookie_path+"; domain="+b.cookie_domain}var C=a("li.settings_info",d);C.find(".settings_info_menu").removeClass("perma_option_off");C.find(".settings_info_menu").append('<span class="settings">Einstellungen</span><form><fieldset><legend>'+b.settings_perma+"</legend></fieldset></form>");if(b.services.facebook.status=="on"&&b.services.facebook.perma_option=="on"&&b.services.facebook.app_id!="__FB_APP-ID__"){var D="";x.socialSharePrivacy_facebook=="perma_on"?D=' checked="checked"':D="";C.find("form fieldset").append('<input type="checkbox" name="perma_status_facebook" id="perma_status_facebook"'+D+' /><label for="perma_status_facebook">'+b.services.facebook.display_name+"</label>")}if(b.services.twitter.status=="on"&&b.services.twitter.perma_option=="on"){var E="";x.socialSharePrivacy_twitter=="perma_on"?E=' checked="checked"':E="";C.find("form fieldset").append('<input type="checkbox" name="perma_status_twitter" id="perma_status_twitter"'+E+' /><label for="perma_status_twitter">'+b.services.twitter.display_name+"</label>")}if(b.services.gplus.status=="on"&&b.services.gplus.perma_option=="on"){var F="";x.socialSharePrivacy_gplus=="perma_on"?F=' checked="checked"':F="";C.find("form fieldset").append('<input type="checkbox" name="perma_status_gplus" id="perma_status_gplus"'+F+' /><label for="perma_status_gplus">'+b.services.gplus.display_name+"</label>")}C.find("input, label").live("mousedown",l);C.find("span.settings").css("cursor","pointer");a(C.find("span.settings"),d).live("mouseenter",function(){var b=window.setTimeout(function(){C.find(".settings_info_menu").removeClass("off").addClass("on")},500);a(this).data("timeout_id",b)});a(C,d).live("mouseleave",function(){var b=a(this).data("timeout_id");window.clearTimeout(b);C.find(".settings_info_menu").removeClass("on").addClass("off")});a(C.find("fieldset input")).live("click",function(c){var e;var f=c.target.id;service=f.substr(f.lastIndexOf("_")+1,f.length);a("#"+c.target.id+":checked").length?e="on":e="off";var g="socialSharePrivacy_"+service;if(e=="on"){A(g,"perma_on",b.cookie_expires,b.cookie_path,b.cookie_domain);a("form fieldset label[for="+f+"]",d).addClass("checked")}else{B(g,"perma_on");a("form fieldset label[for="+f+"]",d).removeClass("checked")}});if(b.services.facebook.status=="on"&&b.services.facebook.perma_option=="on"&&x.socialSharePrivacy_facebook=="perma_on"&&b.services.facebook.app_id!="__FB_APP-ID__"){a("li.facebook span.switch",d).click()}if(b.services.twitter.status=="on"&&b.services.twitter.perma_option=="on"&&x.socialSharePrivacy_twitter=="perma_on"){a("li.twitter span.switch",d).click()}if(b.services.gplus.status=="on"&&b.services.gplus.perma_option=="on"&&x.socialSharePrivacy_gplus=="perma_on"){a("li.gplus span.switch",d).click()}}})}})(jQuery)